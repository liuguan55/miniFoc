
#Uncomment for hardware floating point
SET(FPU_FLAGS "-mfloat-abi=hard -mfpu=fpv4-sp-d16")
add_definitions(-DARM_MATH_CM4 -DARM_MATH_MATRIX_CHECK -DARM_MATH_ROUNDING )
#add_definitions(-DARM_MATH_CM4 -DARM_MATH_MATRIX_CHECK -DARM_MATH_ROUNDING )
#Uncomment for software floating point
#SET(FPU_FLAGS "-mfloat-abi=soft")

SET(COMMON_FLAGS
    "-mcpu=cortex-m4 ${FPU_FLAGS} -mthumb -mthumb-interwork -specs=nano.specs -ffunction-sections -fdata-sections \
    -g -fno-common -fmessage-length=0 -Wall -Werror ")

#add_definitions(-DARM_MATH_CM4 -DARM_MATH_MATRIX_CHECK -DARM_MATH_ROUNDING -D__FPU_PRESENT=1)
add_definitions(-DDEBUG -DUSE_HAL_DRIVER)

string(TOUPPER STM32F4 TARGET_MCU_UPPER)
add_definitions(-DTARGET_MCU_${TARGET_MCU_UPPER})

file(GLOB_RECURSE PLATFORM_SOURCES "src/driver/chip/STM32F4xx_HAL_Driver/*.*"
                     "project/common/startup/STM32F4/*.*")
if (USE_RTOS_SYSTEM)
    list(APPEND PLATFORM_SOURCES  "src/kernel/FreeRTOS/Source/portable/GCC/ARM_CM4F/port.c")
endif()

list(APPEND SOURCES ${PLATFORM_SOURCES})

list(APPEND HEADERS  include/driver/chip/platform/STM32F4
                   include/driver/chip/platform/STM32F4xx_HAL_Driver
                   include/driver/chip/platform/STM32F4xx_HAL_Driver/Legacy
                   include/driver/chip/CMSIS/device/ST/STM32F4xx
                   include/kernel/FreeRTOS/GCC/ARM_CM4F
                   )
